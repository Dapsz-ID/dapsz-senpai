<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dapsz Senpai</title>
  <style>
    /* ---- base ---- */
    :root{
      --purple:#7b3fe4;
      --skyblue:#00c6ff;
      --grad: linear-gradient(135deg,var(--purple),var(--skyblue));
      --bg: linear-gradient(180deg, rgba(8,6,20,0.9), rgba(10,8,25,0.9));
      --card: rgba(18,16,30,0.85);
      --muted:#bdbdbd;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body {
      background: var(--bg);
      color: #eee;
      font-family: "Poppins", Arial, sans-serif;
      margin: 0;
      min-height: 100vh;
      overflow-x: hidden;
      font-size: 1.05rem;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    /* header / brand */
    header {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 72px;
      background: rgba(8,6,20,0.6);
      backdrop-filter: blur(8px);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:16px;
      padding: 8px 16px;
      z-index:1002;
      box-shadow: 0 6px 18px rgba(0,0,0,0.5);
    }
    .brand {
      display:flex;
      align-items:center;
      gap:12px;
    }
    .logo {
      width:44px;height:44px;border-radius:10px;
      background:var(--grad);
      box-shadow: 0 6px 18px rgba(123,63,228,0.18), inset 0 -6px 18px rgba(0,198,255,0.06);
      display:flex;align-items:center;justify-content:center;font-weight:700;color:#fff;
      font-size:1.05rem;
    }
    header h1{
      margin:0;
      font-size:1.15rem;
      letter-spacing:0.4px;
      background: var(--grad);
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
      user-select:none;
    }

    /* header small status (clock/ip/batt) */
    .status-inline { display:flex; gap:12px; align-items:center; color:var(--muted); font-size:0.92rem; }
    .status-item { display:flex; gap:8px; align-items:center; background:rgba(255,255,255,0.02); padding:6px 10px; border-radius:10px; }

    /* hamburger */
    .hamburger {
      width:44px;height:44px;border-radius:10px; display:flex;align-items:center;justify-content:center;
      cursor:pointer;background:rgba(255,255,255,0.02); border:1px solid rgba(255,255,255,0.03);
    }
    .hamburger span{
      display:block;height:3px;width:18px;border-radius:3px;background:var(--purple);
      transition: all .25s ease;
    }
    .hamburger.active span:nth-child(1){transform: rotate(45deg) translate(4px,4px)}
    .hamburger.active span:nth-child(2){opacity:0}
    .hamburger.active span:nth-child(3){transform: rotate(-45deg) translate(4px,-4px)}

    /* sidebar */
    .sidebar{
      position: fixed;
      top: 0;
      right: -340px;
      width: 340px;
      height: 100vh;
      background: linear-gradient(180deg, rgba(10,10,18,0.98), rgba(6,6,12,0.98));
      padding: 90px 18px 20px;
      transition: right .28s cubic-bezier(.2,.9,.2,1);
      z-index:1050;
      box-shadow: -6px 0 40px rgba(0,0,0,0.6);
      display:flex;
      flex-direction:column;
      gap:12px;
    }
    .sidebar.open{right:0}
    .sidebar h2{color:var(--purple); margin:0 0 6px 0; font-weight:700}
    .menu-item{
      background:none;border:none;color:var(--skyblue);text-align:left;padding:12px;border-radius:10px;cursor:pointer;font-size:1.03rem;
      transition: all .15s ease;
    }
    .menu-item.active, .menu-item:hover{background: rgba(123,63,228,0.10); color: var(--purple); font-weight:700; transform:translateX(-4px);}

    /* main container */
    main{padding:100px 18px 36px; min-height:100vh}
    .container{
      background: var(--card);
      padding: 20px;
      border-radius: 16px;
      max-width: 820px;
      margin: 0 auto 24px;
      box-shadow: 0 8px 40px rgba(0,0,0,0.45);
      border: 1px solid rgba(255,255,255,0.02);
    }
    .container h2{margin:0 0 10px 0; font-size:1.3rem; color:#fff}

    input, textarea, select, button {
      font-family: inherit;
      font-size: 1.05rem;
    }
    input, textarea {
      width:100%;
      padding:12px 14px;
      border-radius:12px;
      border:2px solid rgba(255,255,255,0.04);
      background:linear-gradient(180deg, rgba(6,6,10,0.7), rgba(12,12,18,0.75));
      color:#eee;
      outline:none;margin-bottom:12px;
    }
    textarea{min-height:120px; resize:vertical}
    input:focus, textarea:focus{box-shadow:0 6px 30px rgba(123,63,228,0.08); border-color: rgba(0,198,255,0.14)}

    button.primary{
      background: var(--grad);
      color:#07111a;
      border:none;
      padding:10px 18px;
      border-radius:999px;
      cursor:pointer;
      font-weight:800;
      box-shadow: 0 8px 30px rgba(123,63,228,0.12);
    }
    button.primary:hover{transform:translateY(-2px)}

    .result{
      margin-top:12px;
      min-height:60px;
      text-align:center;
      word-wrap:break-word;
      overflow:hidden;
    }

    /* download button style */
    a.download-btn, .download-btn {
      display:inline-block;
      background: var(--grad);
      color:white;
      padding:10px 16px;
      border-radius:10px;
      text-decoration:none;
      font-weight:700;
      margin-top:10px;
      box-shadow: 0 8px 30px rgba(0,198,255,0.08);
    }
    a.download-btn:hover{opacity:0.98; transform:translateY(-2px)}

    /* media */
    .result .media-wrap{
      max-width: 100%;
      width: 100%;
      overflow: hidden;
      display:flex;
      justify-content:center;
      align-items:center;
    }
    .result img, .result video {
      max-width: 95%;
      width: 95%;
      height: auto;
      border-radius:12px;
      display:inline-block;
      margin:10px auto;
      object-fit:contain;
    }

    /* chat bubbles */
    .chat-container{
      max-height:420px;
      overflow-y:auto;
      padding:12px;
      background: rgba(0,0,0,0.15);
      border-radius:12px;
      text-align:left;
      margin-top:12px;
      border: 1px solid rgba(255,255,255,0.02);
    }
    .bubble{display:inline-block;padding:10px 14px;border-radius:14px;margin:8px 0;max-width:78%;white-space:pre-wrap;line-height:1.45}
    .bubble.user{background:linear-gradient(90deg,var(--skyblue),var(--purple)); color:#021226; float:right; clear:both; border-bottom-right-radius:6px}
    .bubble.ai{background:linear-gradient(180deg, rgba(20,20,20,0.95), rgba(28,28,28,0.95));color:#eee; float:left; clear:both; border-bottom-left-radius:6px}

    /* code block style */
    .code-block{
      background:#050507;
      border:1px solid rgba(123,63,228,0.12);
      padding:10px 12px;
      border-radius:10px;
      position:relative;
      overflow:auto;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", "Courier New", monospace;
      margin-top:8px;
      font-size:0.95rem;
    }
    .code-title{color:var(--purple);font-weight:700;margin-bottom:8px}
    .copy-btn{
      position:absolute;right:10px;top:10px;
      background:var(--grad); color:#fff; padding:6px 10px; border-radius:8px; border:none; cursor:pointer; font-weight:700;
      box-shadow: 0 8px 20px rgba(123,63,228,0.12);
    }

    /* loader */
    .loader{border:4px solid rgba(255,255,255,0.06);border-top:4px solid var(--purple);width:40px;height:40px;border-radius:50%;animation:spin 1s linear infinite;margin:14px auto}
    @keyframes spin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}

    /* small screens */
    @media (max-width:740px){
      .sidebar{width:300px; right:-300px}
      main{padding:110px 12px 36px}
      .container{margin:12px}
      header h1{font-size:1.05rem}
      .logo{width:40px;height:40px}
    }
    /* welcome animations */
    @keyframes fadeInUp { from {opacity:0; transform: translateY(8px)} to {opacity:1; transform: translateY(0)} }
  </style>

  <!-- Highlight.js -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/dracula.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
</head>
<body>
  <header>
    <div class="brand" style="align-items:center">
      <div class="logo" aria-hidden="true">DS</div>
      <h1>Dapsz Senpai</h1>
      <div class="status-inline" aria-hidden="true" style="margin-left:12px">
        <div class="status-item">‚è∞ <span id="hdr-clock">--:--</span></div>
        <div class="status-item">üåê <span id="hdr-ip">...</span></div>
        <div class="status-item">üîã <span id="hdr-batt">-</span></div>
      </div>
    </div>

    <div style="display:flex;gap:12px;align-items:center">
      <div class="hamburger" id="hamburger" role="button" aria-label="Toggle menu" tabindex="0" title="Menu">
        <span></span><span></span><span></span>
      </div>
    </div>
  </header>

  <nav class="sidebar" id="sidebar" aria-hidden="true">
    <h2>Menu</h2>
    <button class="menu-item active" id="menu-welcome" type="button">Beranda</button>
    <button class="menu-item" id="menu-generator" type="button">iPhone Quoted Generator</button>
    <button class="menu-item" id="menu-tiktok" type="button">TikTok Downloader</button>
    <button class="menu-item" id="menu-deepseek" type="button">DeepSeek-AI</button>
    <button class="menu-item" id="menu-fakecall" type="button">Fake Call WhatsApp</button>
  </nav>

  <main>
    <div class="container" id="content"></div>
  </main>

  <script>
    /* ---- UI wiring ---- */
    const hamburger = document.getElementById('hamburger');
    const sidebar = document.getElementById('sidebar');
    const content = document.getElementById('content');
    const menuWelcome = document.getElementById('menu-welcome');
    const menuGenerator = document.getElementById('menu-generator');
    const menuTiktok = document.getElementById('menu-tiktok');
    const menuDeepSeek = document.getElementById('menu-deepseek');
    const menuFakeCall = document.getElementById('menu-fakecall');

    function toggleSidebar() {
      const open = sidebar.classList.toggle('open');
      hamburger.classList.toggle('active', open);
      sidebar.setAttribute('aria-hidden', !open);
    }
    hamburger.addEventListener('click', toggleSidebar);
    hamburger.addEventListener('keydown', (e) => {
      if(e.key==='Enter' || e.key===' ') { e.preventDefault(); toggleSidebar(); }
    });

    function clearActive() {
      document.querySelectorAll('.menu-item').forEach(b => b.classList.remove('active'));
    }

    function showSection(id) {
      clearActive();
      document.getElementById(`menu-${id}`)?.classList.add('active');
      // render corresponding
      switch(id){
        case 'welcome': renderWelcome(); break;
        case 'generator': renderGenerator(); break;
        case 'tiktok': renderTiktok(); break;
        case 'deepseek': renderDeepSeek(); break;
        case 'fakecall': renderFakeCall(); break;
        default: renderWelcome();
      }
      // close sidebar on mobile
      if(sidebar.classList.contains('open')) toggleSidebar();
    }

    menuWelcome.addEventListener('click', ()=> showSection('welcome'));
    menuGenerator.addEventListener('click', ()=> showSection('generator'));
    menuTiktok.addEventListener('click', ()=> showSection('tiktok'));
    menuDeepSeek.addEventListener('click', ()=> showSection('deepseek'));
    menuFakeCall.addEventListener('click', ()=> showSection('fakecall'));

    /* ---------------- Welcome / Status-bar ---------------- */
    function renderWelcome(){
      content.innerHTML = `
      <div style="text-align:center; margin-bottom:12px;">
        <div style="font-size:1.25rem; font-weight:700; animation:fadeInUp .9s both; color:transparent; background:var(--grad); -webkit-background-clip:text;">
          Selamat Datang Di Website <span style="opacity:0.98">Dapsz Senpai</span>
        </div>
        <div style="margin-top:8px; color:var(--muted); font-size:1rem; animation:fadeInUp .9s .12s both;">
          Silahkan klik menu untuk info lebih lanjut
        </div>
      </div>
      <div class="container">
        <h2>Beranda</h2>
        <div id="status-bar" style="background:rgba(255,255,255,0.02);padding:12px;border-radius:12px;margin-bottom:14px;font-size:0.98rem;line-height:1.6">
          <p style="margin:6px 0">‚è∞ Jam: <strong id="jam">--:--:--</strong></p>
          <p style="margin:6px 0">üåê IP: <strong id="ip">Mencari...</strong></p>
          <p style="margin:6px 0">üîã Baterai: <strong id="batre">-</strong></p>
          <p style="margin:6px 0">üìç Lokasi: <strong id="lokasi">Mencari...</strong></p>
        </div>
        <p style="font-size:1.08rem; line-height:1.6; user-select:none;">
          <!-- welcome message intentionally only at top -->
        </p>
      </div>`;

      // header small clock
      function updateHeaderClock(){
        const now = new Date();
        const hh = String(now.getHours()).padStart(2,'0');
        const mm = String(now.getMinutes()).padStart(2,'0');
        document.getElementById('hdr-clock').textContent = `${hh}:${mm}`;
      }
      updateHeaderClock(); setInterval(updateHeaderClock, 1000);

      // jam besar di content
      function updateJam(){
        const now = new Date();
        document.getElementById("jam").textContent =
          now.toLocaleTimeString("id-ID",{hour12:false});
      }
      updateJam();
      setInterval(updateJam,1000);

      // IP (content + header)
      fetch("https://api.ipify.org?format=json").then(r=>r.json()).then(d=>{
        if(document.getElementById("ip")) document.getElementById("ip").textContent = d.ip;
        const hdrIp = document.getElementById('hdr-ip');
        if(hdrIp) hdrIp.textContent = d.ip;
      }).catch(()=> {
        if(document.getElementById("ip")) document.getElementById("ip").textContent = "Gagal ambil IP";
        const hdrIp = document.getElementById('hdr-ip');
        if(hdrIp) hdrIp.textContent = "gagal";
      });

      // Battery
      function setBatteryUI(level, charging=false){
        const pct = Math.round(level*100) + "%";
        const txt = charging ? pct + " (üîå Charging)" : pct;
        const el = document.getElementById("batre");
        if(el) el.textContent = txt;
        const hdr = document.getElementById('hdr-batt');
        if(hdr) hdr.textContent = pct;
      }
      if('getBattery' in navigator){
        navigator.getBattery().then(bat=>{
          setBatteryUI(bat.level, bat.charging);
          bat.addEventListener('levelchange', ()=> setBatteryUI(bat.level, bat.charging));
          bat.addEventListener('chargingchange', ()=> setBatteryUI(bat.level, bat.charging));
        }).catch(()=> { const el = document.getElementById("batre"); if(el) el.textContent = "Tidak support" });
      } else {
        const el = document.getElementById("batre"); if(el) el.textContent = "Tidak support";
      }

      // Geolocation
      if(navigator.geolocation){
        navigator.geolocation.getCurrentPosition(pos=>{
          const {latitude,longitude} = pos.coords;
          const loc = document.getElementById("lokasi");
          if(loc) loc.textContent = `${latitude.toFixed(4)}, ${longitude.toFixed(4)}`;
        }, ()=> {
          const loc = document.getElementById("lokasi");
          if(loc) loc.textContent = "Ditolak/gagal";
        });
      } else {
        const loc = document.getElementById("lokasi");
        if(loc) loc.textContent = "Tidak support";
      }
    }

    /* initial render */
    renderWelcome();

    /* ---- Renderers ---- */
    function renderGenerator(){
      content.innerHTML = `
        <div class="container">
          <h2>iPhone Quoted Generator</h2>
          <label style="display:block;text-align:left;margin-bottom:6px">Pesan</label>
          <input id="msg" placeholder="Tulis pesan chat" aria-label="Pesan" />
          
          <label style="display:block;text-align:left;margin-bottom:6px">Jam (contoh: 11:26)</label>
          <input id="gen-jam" placeholder="11:26" aria-label="Jam" />
          
          <label style="display:block;text-align:left;margin-bottom:6px">Statusbar (contoh: INDOSAT OOREDOO 88%)</label>
          <input id="statusbar" placeholder="Status bar" aria-label="Statusbar" />

          <button class="primary" onclick="generateImage()">Buat Quoted</button>
          <div class="result" id="result" aria-live="polite"></div>
        </div>`;
    }

    function renderTiktok(){
      content.innerHTML = `
        <div class="container">
          <h2>TikTok Downloader</h2>
          <input id="tiktok-url" type="url" placeholder="Masukkan URL TikTok" aria-label="Masukkan URL TikTok" />
          <button class="primary" onclick="downloadTiktok()">Download</button>
          <div class="result" id="result" aria-live="polite"></div>
        </div>`;
    }

    function renderDeepSeek(){
      content.innerHTML = `
        <div class="container">
          <h2>DeepSeek-AI</h2>
          <textarea id="deepseek-input" placeholder="Tulis pertanyaanmu di sini..." rows="4"></textarea>
          <div style="display:flex;gap:10px;flex-wrap:wrap;">
            <button class="primary" onclick="askDeepSeek()">Kirim</button>
            <button style="background:rgba(255,255,255,0.06);color:#fff;border-radius:10px;padding:10px 14px;border:none;cursor:pointer;" onclick="clearDeepseek()">Clear</button>
          </div>
          <div class="chat-container" id="deepseek-chat" aria-live="polite"></div>
        </div>`;
    }

    function renderFakeCall(){
      content.innerHTML = `
        <div class="container">
          <h2>Fake Call WhatsApp</h2>
          <label style="display:block;text-align:left;margin-bottom:6px">Nama pemanggil</label>
          <input id="fc-nama" placeholder="Contoh: Ayu, Budi" aria-label="Nama pemanggil" />
          <label style="display:block;text-align:left;margin-bottom:6px">Durasi (detik)</label>
          <input id="fc-durasi" type="number" placeholder="Contoh: 30" aria-label="Durasi (detik)" />
          <label style="display:block;text-align:left;margin-bottom:6px">Avatar (URL gambar, optional)</label>
          <input id="fc-avatar" placeholder="https://..." aria-label="Avatar URL" />
          <button class="primary" onclick="generateFakeCall()">Buat Fake Call</button>
          <div class="result" id="fakecall-result" aria-live="polite"></div>
        </div>`;
    }

    /* ---- Utilities ---- */
    function escapeHtml(s=''){ return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;'); }

    /* ---- iPhone Quoted Generator (api.zenzxz.my.id) ---- */
    window.generateImage = function(){
      const msg = document.getElementById('msg')?.value?.trim();
      const jam = document.getElementById('gen-jam')?.value?.trim() || "11:26";
      const statusbar = document.getElementById('statusbar')?.value?.trim() || "INDOSAT OOREDOO 88%";
      const resultDiv = document.getElementById('result');
      
      if(!msg){ alert('Harap masukkan pesan!'); return; }
      
      resultDiv.innerHTML = '<div class="loader" role="status" aria-label="Loading"></div><p>Memproses...</p>';

      const apiUrl = `https://api.zenzxz.my.id/maker/fakechatiphone?text=${encodeURIComponent(msg)}&time=${encodeURIComponent(jam)}&statusbar=${encodeURIComponent(statusbar)}`;

      setTimeout(()=>{
        resultDiv.innerHTML = `
          <p style="text-align:left;color:var(--muted);margin:6px 0">Hasil:</p>
          <div class="media-wrap">
            <img src="${apiUrl}" alt="Quoted image" 
                 onerror="this.style.display='none'; this.parentElement.insertAdjacentHTML('beforeend','<p>Gagal memuat gambar.</p>');" />
          </div>
          <a class="download-btn" href="${apiUrl}" target="_blank" rel="noopener" download="quoted.png">‚¨áÔ∏è Download</a>
        `;
      }, 500);
    };

    /* ---- TikTok Downloader (izumiiiiiiii.dpdns.org) ---- */
    window.downloadTiktok = async function(){
      const url = document.getElementById('tiktok-url')?.value?.trim();
      const resultDiv = document.getElementById('result');
      if(!url){ alert('Harap masukkan URL TikTok!'); return; }
      resultDiv.innerHTML = '<div class="loader" role="status" aria-label="Loading"></div><p>Mengunduh...</p>';

      try{
        const api = `https://izumiiiiiiii.dpdns.org/downloader/tiktok?url=${encodeURIComponent(url)}`;
        const res = await fetch(api);
        if(!res.ok) throw new Error('HTTP ' + res.status);
        const data = await res.json();

        if(data?.status === true && data?.result){
          const videoUrl = data.result.hdplay || data.result.play || data.result.wmplay;
          if(videoUrl){
            resultDiv.innerHTML = `
              <p style="text-align:left;color:var(--muted);margin:6px 0"><strong>${escapeHtml(data.result.title || 'Video TikTok')}</strong></p>
              <div class="media-wrap">
                <video controls autoplay muted loop playsinline>
                  <source src="${videoUrl}" type="video/mp4" />
                  Browser Anda tidak mendukung video.
                </video>
              </div>
              <a class="download-btn" href="${videoUrl}" target="_blank" rel="noopener" download="tiktok.mp4">‚¨áÔ∏è Download Video</a>
            `;
          } else {
            resultDiv.innerHTML = '<p>Tidak ditemukan link video dalam respon API.</p>';
          }
        } else {
          resultDiv.innerHTML = `<p>Gagal mendapatkan video: ${escapeHtml(data?.message || 'Unknown error')}</p>`;
        }
      }catch(err){
        console.error('downloadTiktok error', err);
        resultDiv.innerHTML = `<p>Error: ${escapeHtml(err.message)}</p>`;
      }
    };

    /* ---- Fake Call WhatsApp (api.zenzxz.my.id) ---- */
    window.generateFakeCall = async function(){
      const name = (document.getElementById('fc-nama')?.value || '').trim();
      const duration = (document.getElementById('fc-durasi')?.value || '').trim();
      const avatar = (document.getElementById('fc-avatar')?.value || '').trim();
      const resultDiv = document.getElementById('fakecall-result');

      if(!name){ alert('Masukkan nama pemanggil!'); return; }
      if(!duration || isNaN(duration) || Number(duration) <= 0){ alert('Masukkan durasi valid (detik)!'); return; }

      resultDiv.innerHTML = '<div class="loader" role="status" aria-label="Loading"></div><p>Menghasilkan fake call...</p>';

      try{
        const api = `https://api.zenzxz.my.id/maker/fakecall?nama=${encodeURIComponent(name)}&durasi=${encodeURIComponent(duration)}&avatar=${encodeURIComponent(avatar)}`;
        const res = await fetch(api);
        if(!res.ok) throw new Error('HTTP ' + res.status);
        const ct = (res.headers.get('content-type') || '').toLowerCase();

        if(ct.includes('application/json')){
          const json = await res.json();
          // cari URL image di beberapa kemungkinan field
          const img = json?.result?.url || json?.url || json?.result?.image || null;
          if(img){
            resultDiv.innerHTML = `
              <p style="text-align:left;color:var(--muted);margin:6px 0"><strong>Fake Call untuk: ${escapeHtml(name)}</strong></p>
              <div class="media-wrap">
                <img src="${img}" alt="Fake Call Preview" onerror="this.style.display='none'; this.parentElement.insertAdjacentHTML('beforeend','<p>Gagal memuat preview.</p>');" />
              </div>
              <a class="download-btn" href="${img}" target="_blank" rel="noopener" download="fakecall.png">‚¨áÔ∏è Download</a>
            `;
          } else {
            // tampilkan json untuk debug
            resultDiv.innerHTML = `<pre style="text-align:left;background:#0b0b0b;padding:10px;border-radius:8px;max-height:320px;overflow:auto;">${escapeHtml(JSON.stringify(json,null,2))}</pre>`;
          }
          return;
        }

        if(ct.startsWith('image/') || ct.includes('octet-stream')){
          const blob = await res.blob();
          const urlBlob = URL.createObjectURL(blob);
          resultDiv.innerHTML = `
            <p style="text-align:left;color:var(--muted);margin:6px 0"><strong>Fake Call untuk: ${escapeHtml(name)}</strong></p>
            <div class="media-wrap">
              <img src="${urlBlob}" alt="Fake Call Preview" />
            </div>
            <a class="download-btn" href="${urlBlob}" target="_blank" rel="noopener" download="fakecall.png">‚¨áÔ∏è Download</a>
          `;
          return;
        }

        // fallback: text
        const text = await res.text();
        resultDiv.innerHTML = `<pre style="text-align:left;background:#0b0b0b;padding:10px;border-radius:8px;max-height:320px;overflow:auto;">${escapeHtml(text)}</pre>`;
      }catch(err){
        console.error('generateFakeCall error', err);
        resultDiv.innerHTML = `<p>Error: ${escapeHtml(err.message)}. Cek console/network.</p>`;
      }
    };

    /* ---- DeepSeek AI (parsing code blocks + highlight) ---- */
    window.askDeepSeek = async function(){
      const inputEl = document.getElementById('deepseek-input');
      const input = inputEl?.value?.trim();
      const chatDiv = document.getElementById('deepseek-chat');
      if(!input){ alert('Harap tulis pertanyaan!'); return; }

      // append user bubble
      chatDiv.innerHTML += `<div class="bubble user">${escapeHtml(input)}</div>`;
      chatDiv.scrollTop = chatDiv.scrollHeight;

      const loaderId = 'loader-'+Date.now();
      chatDiv.innerHTML += `<div id="${loaderId}" class="bubble ai"><div class="loader" aria-hidden="true"></div></div>`;
      chatDiv.scrollTop = chatDiv.scrollHeight;

      // clear input for UX
      if(inputEl) inputEl.value = '';

      try{
        const endpoint = `https://izumiiiiiiii.dpdns.org/ai/deepseek?messages=${encodeURIComponent(input)}`;
        const res = await fetch(endpoint);
        const data = await res.json();
        // remove loader
        const loaderEl = document.getElementById(loaderId);
        if(loaderEl) loaderEl.remove();

        if(data?.status === true && data?.message){
          let msg = data.message;

          // parse markdown code blocks ```lang\ncode\n```
          const regex = /```(\w+)?\n([\s\S]*?)```/g;
          let final = msg;
          const blocks = [];
          let idx = 0;
          final = msg.replace(regex, function(full, g1, g2){
            const lang = (g1||'text').toLowerCase();
            const code = g2 || '';
            const placeholder = `[[CODEBLOCK_${idx}]]`;
            blocks.push({lang, code, placeholder});
            idx++;
            return placeholder;
          });

          // escape remaining HTML and convert newlines to <br>
          final = escapeHtml(final).replace(/\n/g,'<br>');

          // replace placeholders with proper code HTML
          blocks.forEach((b)=>{
            const codeHtml = `
              <div class="code-block">
                <div class="code-title">${escapeHtml((b.lang||'text').toUpperCase())}</div>
                <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                <pre><code class="language-${escapeHtml(b.lang)}">${escapeHtml(b.code)}</code></pre>
              </div>
            `;
            final = final.replace(b.placeholder, codeHtml);
          });

          // append AI bubble with assembled HTML
          chatDiv.innerHTML += `<div class="bubble ai">${final}</div>`;

          // highlight inserted code elements
          setTimeout(()=>{ 
            document.querySelectorAll('#deepseek-chat pre code').forEach((el)=>{ 
              try{ hljs.highlightElement(el); }catch(e){/* ignore */} 
            });
          }, 40);

        } else {
          chatDiv.innerHTML += `<div class="bubble ai">Gagal mendapatkan jawaban.</div>`;
        }
      }catch(err){
        const loaderEl2 = document.getElementById(loaderId);
        if(loaderEl2) loaderEl2.remove();
        console.error('askDeepSeek error', err);
        chatDiv.innerHTML += `<div class="bubble ai">Error: ${escapeHtml(err.message)}</div>`;
      }
      chatDiv.scrollTop = chatDiv.scrollHeight;
    };

    /* ---- copy code helper ---- */
    function copyCode(btn){
      // find nearest code inside the same code-block
      const block = btn.closest('.code-block');
      if(!block) return;
      const codeEl = block.querySelector('pre code');
      if(!codeEl) return;
      const text = codeEl.innerText || codeEl.textContent || '';
      navigator.clipboard.writeText(text).then(()=>{
        const old = btn.innerText;
        btn.innerText = 'Copied!';
        setTimeout(()=> btn.innerText = old, 1400);
      }).catch(()=> alert('Gagal salin ke clipboard'));
    }

    /* ---- clearDeepseek: reset input + remove last AI output ---- */
    function clearDeepseek(){
      const input = document.getElementById('deepseek-input');
      if(input) input.value = '';
      const chatDiv = document.getElementById('deepseek-chat');
      if(!chatDiv) return;
      // find last AI bubble (from end)
      const bubbles = Array.from(chatDiv.querySelectorAll('.bubble.ai'));
      if(bubbles.length > 0){
        const lastAi = bubbles[bubbles.length - 1];
        lastAi.remove();
      }
    }

    /* keep focus UX: close sidebar when clicking outside on mobile */
    document.addEventListener('click', (e)=>{
      if(!sidebar.contains(e.target) && !hamburger.contains(e.target) && sidebar.classList.contains('open')){
        toggleSidebar();
      }
    });

    /* keyboard nav for menu (accessibility) */
    document.addEventListener('keydown', (e)=>{
      if(e.key === 'Escape' && sidebar.classList.contains('open')) toggleSidebar();
    });

    /* initialize highlight.js config */
    if(window.hljs && hljs.configure) {
      hljs.configure({ignoreUnescapedHTML: true});
    }
  </script>
</body>
</html>
