                menuDeepSeek.addEventListener('click', ()=> showSection('deepseek'));
    menuFakeCall.addEventListener('click', ()=> showSection('fakecall'));

    /* ---------------- Welcome / Status-bar ---------------- */
    function renderWelcome(){
      content.innerHTML = `
      <div style="text-align:center; margin-bottom:12px;">
        <div style="font-size:1.25rem; font-weight:700; animation:fadeInUp .9s both; color:transparent; background:var(--grad); -webkit-background-clip:text;">
          Selamat Datang Di Website <span style="opacity:0.98">Dapsz Senpai</span>
        </div>
        <div style="margin-top:8px; color:var(--muted); font-size:1rem; animation:fadeInUp .9s .12s both;">
          Silahkan klik menu untuk info lebih lanjut
        </div>
      </div>
      <div class="container">
        <h2>Beranda</h2>
        <div id="status-bar" style="background:rgba(255,255,255,0.02);padding:12px;border-radius:12px;margin-bottom:14px;font-size:0.98rem;line-height:1.6">
          <p style="margin:6px 0">‚è∞ Jam: <strong id="jam">--:--:--</strong></p>
          <p style="margin:6px 0">üåê IP: <strong id="ip">Mencari...</strong></p>
          <p style="margin:6px 0">üîã Baterai: <strong id="batre">-</strong></p>
          <p style="margin:6px 0">üìç Lokasi: <strong id="lokasi">Mencari...</strong></p>
        </div>
        <p style="font-size:1.08rem; line-height:1.6; user-select:none;">
          Selamat Datang di Website Dapsz Senpai,<br/>Pilih menu untuk mencoba fitur.
        </p>
      </div>`;

      // header small clock
      function updateHeaderClock(){
        const now = new Date();
        const hh = String(now.getHours()).padStart(2,'0');
        const mm = String(now.getMinutes()).padStart(2,'0');
        document.getElementById('hdr-clock').textContent = `${hh}:${mm}`;
      }
      updateHeaderClock(); setInterval(updateHeaderClock, 1000);

      // jam besar di content
      function updateJam(){
        const now = new Date();
        document.getElementById("jam").textContent =
          now.toLocaleTimeString("id-ID",{hour12:false});
      }
      updateJam();
      setInterval(updateJam,1000);

      // IP (content + header)
      fetch("https://api.ipify.org?format=json").then(r=>r.json()).then(d=>{
        document.getElementById("ip").textContent = d.ip;
        const hdrIp = document.getElementById('hdr-ip');
        if(hdrIp) hdrIp.textContent = d.ip;
      }).catch(()=> {
        document.getElementById("ip").textContent = "Gagal ambil IP";
        const hdrIp = document.getElementById('hdr-ip');
        if(hdrIp) hdrIp.textContent = "gagal";
      });

      // Battery
      function setBatteryUI(level, charging=false){
        const pct = Math.round(level*100) + "%";
        const txt = charging ? pct + " (üîå Charging)" : pct;
        const el = document.getElementById("batre");
        if(el) el.textContent = txt;
        const hdr = document.getElementById('hdr-batt');
        if(hdr) hdr.textContent = pct;
      }
      if(navigator.getBattery){
        navigator.getBattery().then(bat=>{
          setBatteryUI(bat.level, bat.charging);
          bat.addEventListener('levelchange', ()=> setBatteryUI(bat.level, bat.charging));
          bat.addEventListener('chargingchange', ()=> setBatteryUI(bat.level, bat.charging));
        }).catch(()=> document.getElementById("batre").textContent = "Tidak support");
      } else {
        document.getElementById("batre").textContent = "Tidak support";
      }

      // Geolocation
      if(navigator.geolocation){
        navigator.geolocation.getCurrentPosition(pos=>{
          const {latitude,longitude} = pos.coords;
          document.getElementById("lokasi").textContent = `${latitude.toFixed(4)}, ${longitude.toFixed(4)}`;
        }, ()=> document.getElementById("lokasi").textContent = "Ditolak/gagal");
      } else {
        document.getElementById("lokasi").textContent = "Tidak support";
      }
    }

    /* initial render */
    renderWelcome();

    /* ---- Renderers ---- */
    function renderGenerator(){
      content.innerHTML = `
        <div class="container">
          <h2>iPhone Quoted Generator</h2>
          <label style="display:block;text-align:left;margin-bottom:6px">Pesan</label>
          <input id="msg" placeholder="Tulis pesan chat" aria-label="Pesan" />
          
          <label style="display:block;text-align:left;margin-bottom:6px">Jam (contoh: 11:26)</label>
          <input id="gen-jam" placeholder="11:26" aria-label="Jam" />
<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dapsz Senpai</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: linear-gradient(135deg, #8e44ad, #00c6ff);
      color: #fff;
      overflow-x: hidden;
    }
    header {
      background: rgba(0,0,0,0.5);
      padding: 15px;
      text-align: center;
      position: sticky;
      top: 0;
      z-index: 1000;
    }
    header h1 {
      margin: 0;
      font-size: 1.5em;
    }
    .container {
      padding: 20px;
      margin: auto;
      max-width: 900px;
    }
    .menu {
      background: rgba(0,0,0,0.6);
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 20px;
    }
    .menu h2 {
      margin-top: 0;
      font-size: 1.3em;
    }
    input, button, textarea {
      padding: 10px;
      border-radius: 8px;
      border: none;
      margin: 5px 0;
      width: 100%;
    }
    button {
      background: linear-gradient(135deg, #8e44ad, #00c6ff);
      color: white;
      cursor: pointer;
    }
    button:hover { opacity: 0.9; }
    .statusbar {
      display: flex;
      justify-content: space-between;
      font-size: 0.9em;
      margin-bottom: 10px;
    }
    .chat-output {
      background: rgba(0,0,0,0.7);
      padding: 10px;
      border-radius: 10px;
      margin-top: 10px;
      max-height: 300px;
      overflow-y: auto;
    }
    .bubble {
      margin: 5px 0;
      padding: 10px;
      border-radius: 10px;
      max-width: 80%;
      word-wrap: break-word;
    }
    .bubble.user {
      background: #2c82c9;
      align-self: flex-end;
    }
    .bubble.ai {
      background: #27ae60;
      align-self: flex-start;
    }
    pre {
      background: #111;
      padding: 10px;
      border-radius: 8px;
      overflow-x: auto;
      position: relative;
      color: #eee;
    }
    .copy-btn {
      position: absolute;
      right: 10px; top: 10px;
      background: #444;
      color: #fff;
      border: none;
      padding: 5px 10px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 0.8em;
    }
    /* Sidebar */
    .sidebar {
      height: 100%;
      width: 0;
      position: fixed;
      z-index: 2000;
      top: 0;
      left: 0;
      background: rgba(0,0,0,0.95);
      overflow-x: hidden;
      transition: 0.4s;
      padding-top: 60px;
    }
    .sidebar a {
      padding: 10px 20px;
      text-decoration: none;
      color: #fff;
      display: block;
      transition: 0.3s;
    }
    .sidebar a:hover { background: rgba(255,255,255,0.1); }
    .openbtn {
      font-size: 20px;
      cursor: pointer;
      background: none;
      border: none;
      color: white;
      padding: 10px 15px;
    }
    .closebtn {
      position: absolute;
      top: 10px; right: 20px;
      font-size: 30px;
      color: white;
      text-decoration: none;
    }
  </style>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/dracula.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
</head>
<body>
  <header>
    <button class="openbtn" onclick="openNav()">‚ò∞</button>
    <h1>Dapsz Senpai</h1>
  </header>

  <div id="mySidebar" class="sidebar">
    <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">√ó</a>
    <a href="#" onclick="renderHome()">Home</a>
    <a href="#" onclick="renderFakechat()">Fakechat iPhone</a>
    <a href="#" onclick="renderTiktok()">TikTok Downloader</a>
    <a href="#" onclick="renderDeepseek()">DeepSeek AI</a>
    <a href="#" onclick="renderFakecall()">Fakecall WhatsApp</a>
  </div>

  <div class="container" id="content"></div>

  <script>
    function openNav(){ document.getElementById("mySidebar").style.width="250px"; }
    function closeNav(){ document.getElementById("mySidebar").style.width="0"; }

    function renderHome(){
      content.innerHTML = `
        <div class="menu">
          <h2>Selamat Datang üëã</h2>
          <p>Ini adalah website multi-fitur Dapsz Senpai ‚ú®</p>
        </div>`;
    }

   renderHome();
    
    function renderFakechat(){
      content.innerHTML = `
        <div class="menu">
          <h2>iPhone Quoted Generator</h2>
          <div class="statusbar"><span>09:41</span><span>üîã100%</span></div>
          <input id="msg" placeholder="Tulis pesan..." />
          <button onclick="makeFakechat()">Generate</button>
          <div id="result"></div>
        </div>`;
    }
    async function makeFakechat(){
      const text = document.getElementById("msg").value;
      if(!text) return;
      const res = await fetch("https://api.zenzxz.my.id/maker/fakechatiphone?text="+encodeURIComponent(text));
      const data = await res.json();
      document.getElementById("result").innerHTML = `<img src="${data.result}" style="max-width:100%">`;
    }

    function renderTiktok(){
      content.innerHTML = `
        <div class="menu">
          <h2>TikTok Downloader</h2>
          <input id="tturl" placeholder="Masukkan URL TikTok..." />
          <button onclick="getTiktok()">Download</button>
          <div id="ttresult"></div>
        </div>`;
    }
    async function getTiktok(){
      const url = document.getElementById("tturl").value;
      if(!url) return;
      const res = await fetch("https://izumiiiiiiii.dpdns.org/api/download/tiktok?url="+encodeURIComponent(url));
      const data = await res.json();
      document.getElementById("ttresult").innerHTML = `
        <video src="${data.result}" controls style="max-width:100%"></video>`;
    }

    function renderDeepseek(){
      content.innerHTML = `
        <div class="menu">
          <h2>DeepSeek AI</h2>
          <div class="chat-input">
            <input id="deepseek-input" type="text" placeholder="Tulis pertanyaanmu di sini..." />
            <button onclick="sendDeepseek()">Kirim</button>
            <button onclick="clearDeepseek()">Clear</button>
          </div>
          <div id="deepseek-output" class="chat-output"></div>
        </div>`;
    }
    function sendDeepseek(){
      const input = document.getElementById("deepseek-input");
      const output = document.getElementById("deepseek-output");
      if(input.value.trim()==="") return;
      output.innerHTML += `<div class="bubble user">${input.value}</div>`;
      askDeepSeek(input.value);
      input.value="";
    }
    function clearDeepseek(){
      document.getElementById("deepseek-input").value="";
      document.getElementById("deepseek-output").innerHTML="";
    }
    async function askDeepSeek(q){
      const chatDiv = document.getElementById("deepseek-output");
      const loaderId = "loader"+Date.now();
      chatDiv.innerHTML += `<div id="${loaderId}" class="bubble ai">‚è≥ Thinking...</div>`;
      chatDiv.scrollTop=chatDiv.scrollHeight;
      try{
        const res = await fetch("https://api.zenzxz.my.id/deepseek?q="+encodeURIComponent(q));
        const data = await res.json();
        document.getElementById(loaderId)?.remove();
        if(data && data.result){
          chatDiv.innerHTML += `<div class="bubble ai">${data.result}</div>`;
          chatDiv.querySelectorAll("pre code").forEach(el=>hljs.highlightElement(el));
        } else {
          chatDiv.innerHTML += `<div class="bubble ai">Gagal: ${data?.message||'Unknown error'}</div>`;
        }
        chatDiv.scrollTop=chatDiv.scrollHeight;
      }catch(err){
        document.getElementById(loaderId)?.remove();
        chatDiv.innerHTML += `<div class="bubble ai">Error: ${err.message}</div>`;
        chatDiv.scrollTop=chatDiv.scrollHeight;
      }
    }

    function renderFakecall(){
      content.innerHTML = `
        <div class="menu">
          <h2>Fakecall WhatsApp</h2>
          <input id="fcname" placeholder="Nama Caller..." />
          <button onclick="makeFakecall()">Generate</button>
          <div id="fcresult"></div>
        </div>`;
    }
    async function makeFakecall(){
      const name = document.getElementById("fcname").value;
      if(!name) return;
      const res = await fetch("https://api.zenzxz.my.id/maker/fakecall?nama="+encodeURIComponent(name));
      const data = await res.json();
      document.getElementById("fcresult").innerHTML = `<img src="${data.result}" style="max-width:100%">`;
    }
    



    /* ---- Utilities ---- */
    function escapeHtml(s=''){ return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;'); }

    /* ---- iPhone Quoted Generator (brat.siputzx.my.id) ---- */
    window.generateImage = function(){
      const msg = document.getElementById('msg')?.value?.trim();
      const jam = document.getElementById('gen-jam')?.value?.trim() || "11:26";
      const statusbar = document.getElementById('statusbar')?.value?.trim() || "INDOSAT OOREDOO 88%";
      const resultDiv = document.getElementById('result');
      
      if(!msg){ alert('Harap masukkan pesan!'); return; }
      
      resultDiv.innerHTML = '<div class="loader" role="status" aria-label="Loading"></div><p>Memproses...</p>';

      const apiUrl = `https://api.zenzxz.my.id/maker/fakechatiphone?text=${encodeURIComponent(msg)}&time=${encodeURIComponent(jam)}&statusbar=${encodeURIComponent(statusbar)}`;

      setTimeout(()=>{
        resultDiv.innerHTML = `
          <p style="text-align:left;color:var(--muted);margin:6px 0">Hasil:</p>
          <div class="media-wrap">
            <img src="${apiUrl}" alt="Quoted image" 
                 onerror="this.style.display='none'; this.parentElement.insertAdjacentHTML('beforeend','<p>Gagal memuat gambar.</p>');" />
          </div>
          <a class="download-btn" href="${apiUrl}" target="_blank" rel="noopener" download="quoted.png">‚¨áÔ∏è Download</a>
        `;
      }, 500);
    };


    /* ---- TikTok Downloader (izumiiiiiiii.dpdns.org) ---- */
    window.downloadTiktok = async function(){
      const url = document.getElementById('tiktok-url')?.value?.trim();
      const resultDiv = document.getElementById('result');
      if(!url){ alert('Harap masukkan URL TikTok!'); return; }
      resultDiv.innerHTML = '<div class="loader" role="status" aria-label="Loading"></div><p>Mengunduh...</p>';

      try{
        const api = `https://izumiiiiiiii.dpdns.org/downloader/tiktok?url=${encodeURIComponent(url)}`;
        const res = await fetch(api);
        if(!res.ok) throw new Error('HTTP ' + res.status);
        const data = await res.json();

        if(data?.status === true && data?.result){
          const videoUrl = data.result.hdplay || data.result.play || data.result.wmplay;
          if(videoUrl){
            resultDiv.innerHTML = `
              <p style="text-align:left;color:var(--muted);margin:6px 0"><strong>${escapeHtml(data.result.title || 'Video TikTok')}</strong></p>
              <div class="media-wrap">
                <video controls autoplay muted loop playsinline>
                  <source src="${videoUrl}" type="video/mp4" />
                  Browser Anda tidak mendukung video.
                </video>
              </div>
              <a class="download-btn" href="${videoUrl}" target="_blank" rel="noopener" download="tiktok.mp4">‚¨áÔ∏è Download Video</a>
            `;
          } else {
            resultDiv.innerHTML = '<p>Tidak ditemukan link video dalam respon API.</p>';
          }
        } else {
          resultDiv.innerHTML = `<p>Gagal mendapatkan video: ${escapeHtml(data?.message || 'Unknown error')}</p>`;
        }
      }catch(err){
        console.error('downloadTiktok error', err);
        resultDiv.innerHTML = `<p>Error: ${escapeHtml(err.message)}</p>`;
      }
    };

    /* ---- Fake Call WhatsApp (api.zenzxz.my.id) ---- */
    window.generateFakeCall = async function(){
      const name = (document.getElementById('fc-nama')?.value || '').trim();
      const duration = (document.getElementById('fc-durasi')?.value || '').trim();
      const avatar = (document.getElementById('fc-avatar')?.value || '').trim();
      const resultDiv = document.getElementById('fakecall-result');

      if(!name){ alert('Masukkan nama pemanggil!'); return; }
      if(!duration || isNaN(duration) || Number(duration) <= 0){ alert('Masukkan durasi valid (detik)!'); return; }

      resultDiv.innerHTML = '<div class="loader" role="status" aria-label="Loading"></div><p>Menghasilkan fake call...</p>';

      try{
        const api = `https://api.zenzxz.my.id/maker/fakecall?nama=${encodeURIComponent(name)}&durasi=${encodeURIComponent(duration)}&avatar=${encodeURIComponent(avatar)}`;
        const res = await fetch(api);
        if(!res.ok) throw new Error('HTTP ' + res.status);
        const ct = (res.headers.get('content-type') || '').toLowerCase();

        if(ct.includes('application/json')){
          const json = await res.json();
          // cari URL image di beberapa kemungkinan field
          const img = json?.result?.url || json?.url || json?.result?.image || null;
          if(img){
            resultDiv.innerHTML = `
              <p style="text-align:left;color:var(--muted);margin:6px 0"><strong>Fake Call untuk: ${escapeHtml(name)}</strong></p>
              <div class="media-wrap">
                <img src="${img}" alt="Fake Call Preview" onerror="this.style.display='none'; this.parentElement.insertAdjacentHTML('beforeend','<p>Gagal memuat preview.</p>');" />
              </div>
              <a class="download-btn" href="${img}" target="_blank" rel="noopener" download="fakecall.png">‚¨áÔ∏è Download</a>
            `;
          } else {
            // tampilkan json untuk debug
            resultDiv.innerHTML = `<pre style="text-align:left;background:#0b0b0b;padding:10px;border-radius:8px;max-height:320px;overflow:auto;">${escapeHtml(JSON.stringify(json,null,2))}</pre>`;
          }
          return;
        }

        if(ct.startsWith('image/') || ct.includes('octet-stream')){
          const blob = await res.blob();
          const urlBlob = URL.createObjectURL(blob);
          resultDiv.innerHTML = `
            <p style="text-align:left;color:var(--muted);margin:6px 0"><strong>Fake Call untuk: ${escapeHtml(name)}</strong></p>
            <div class="media-wrap">
              <img src="${urlBlob}" alt="Fake Call Preview" />
            </div>
            <a class="download-btn" href="${urlBlob}" target="_blank" rel="noopener" download="fakecall.png">‚¨áÔ∏è Download</a>
          `;
          return;
        }

        // fallback: text
        const text = await res.text();
        resultDiv.innerHTML = `<pre style="text-align:left;background:#0b0b0b;padding:10px;border-radius:8px;max-height:320px;overflow:auto;">${escapeHtml(text)}</pre>`;
      }catch(err){
        console.error('generateFakeCall error', err);
        resultDiv.innerHTML = `<p>Error: ${escapeHtml(err.message)}. Cek console/network.</p>`;
      }
    };

    /* ---- DeepSeek AI (parsing code blocks + highlight) ---- */
    window.askDeepSeek = async function(){
      const input = document.getElementById('deepseek-input')?.value?.trim();
      const chatDiv = document.getElementById('deepseek-chat');
      if(!input){ alert('Harap tulis pertanyaan!'); return; }

      // append user bubble
      chatDiv.innerHTML += `<div class="bubble user">${escapeHtml(input)}</div>`;
      chatDiv.scrollTop = chatDiv.scrollHeight;

      const loaderId = 'loader-'+Date.now();
      chatDiv.innerHTML += `<div id="${loaderId}" class="bubble ai"><div class="loader" aria-hidden="true"></div></div>`;
      chatDiv.scrollTop = chatDiv.scrollHeight;

      try{
        const endpoint = `https://izumiiiiiiii.dpdns.org/ai/deepseek?messages=${encodeURIComponent(input)}`;
        const res = await fetch(endpoint);
        const data = await res.json();
        // remove loader
        const loaderEl = document.getElementById(loaderId);
        if(loaderEl) loaderEl.remove();

        if(data?.status === true && data?.message){
          let msg = data.message;

          // parse markdown code blocks ```lang\ncode\n```
          const regex = /```(\w+)?\n([\s\S]*?)```/g;
          let final = msg;
          let m;
          const blocks = [];
          // we will replace with placeholders to avoid nested HTML issues
          let idx = 0;
          final = msg.replace(regex, function(full, g1, g2){
            const lang = (g1||'text').toLowerCase();
            const code = g2 || '';
            const placeholder = `[[CODEBLOCK_${idx}]]`;
            blocks.push({lang, code, placeholder});
            idx++;
            return placeholder;
          });

          // escape remaining HTML
          final = escapeHtml(final).replace(/\n/g,'<br>');

          // assemble HTML replacing placeholders with proper code-block markup
          blocks.forEach((b, i)=>{
            const codeHtml = `
              <div class="code-block">
                <div class="code-title">${escapeHtml((b.lang||'text').toUpperCase())}</div>
                <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                <pre><code class="language-${escapeHtml(b.lang)}">${escapeHtml(b.code)}</code></pre>
              </div>
            `;
            final = final.replace(b.placeholder, codeHtml);
          });

          // append final inside ai bubble
          chatDiv.innerHTML += `<div class="bubble ai">${final}</div>`;

          // run highlight on inserted code elements
          // wait microtask to ensure DOM nodes exist
          setTimeout(()=>{ 
            document.querySelectorAll('#deepseek-chat pre code').forEach((el)=>{ 
              try{ hljs.highlightElement(el); }catch(e){/* ignore */} 
            });
          }, 30);
        } else {
          chatDiv.innerHTML += `<div class="bubble ai">Gagal mendapatkan jawaban.</div>`;
        }
      }catch(err){
        const loaderEl = document.getElementById(loaderId);
        if(loaderEl) loaderEl.remove();
        console.error('askDeepSeek error', err);
        chatDiv.innerHTML += `<div class="bubble ai">Error: ${escapeHtml(err.message)}</div>`;
      }
      chatDiv.scrollTop = chatDiv.scrollHeight;
    };

    /* ---- copy code helper ---- */
    function copyCode(btn){
      // find nearest code inside the same code-block
      const block = btn.closest('.code-block');
      if(!block) return;
      const codeEl = block.querySelector('pre code');
      if(!codeEl) return;
      const text = codeEl.innerText || codeEl.textContent || '';
      navigator.clipboard.writeText(text).then(()=>{
        const old = btn.innerText;
        btn.innerText = 'Copied!';
        setTimeout(()=> btn.innerText = old, 1400);
      }).catch(()=> alert('Gagal salin ke clipboard'));
    }

    /* keep focus UX: close sidebar when clicking outside on mobile */
    document.addEventListener('click', (e)=>{
      if(!sidebar.contains(e.target) && !hamburger.contains(e.target) && sidebar.classList.contains('open')){
        toggleSidebar();
      }
    });

    /* keyboard nav for menu (accessibility) */
    document.addEventListener('keydown', (e)=>{
      if(e.key === 'Escape' && sidebar.classList.contains('open')) toggleSidebar();
    });
  </script>

  <!-- initialize highlight (safe to call early) -->
  <script>window.hljs && hljs.configure({ignoreUnescapedHTML: true});</script>
</body>
</html>
                                      
